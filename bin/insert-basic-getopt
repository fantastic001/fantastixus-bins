#!/bin/bash

IFS=''

SHORTOPTS=":h"
LONGOPTS="help"
OPTS=$(getopt -o $SHORTOPTS --longoptions $LONGOPTS -n "$0" -- "$@")
eval set -- "$OPTS"

while [ $# -gt 0 ]; do
    case $1 in
        -h|--help)
            echo "Usage: insert-basic-geopt [OPTION]... [FILE]..."
            echo "Insert basic getopt sintax in all files in directory"
            echo 
            echo "First parameter is a path to dir with files"
            echo -e "-h, --help \t\t\t Print this message"
        	exit 0
        ;;

        --)
            shift
            break
        ;;

    esac
    shift
done

if [[ -z "$1" ]]; then
    echo "Directory to be affected is not provided!"
    echo "Stopping..."
    exit 1
fi 

GETOPT_CODE="$( cat ../data/basic-getopt-code )"

echo "Affected files: "

for file in $1/*
do
    if [[ ! $( grep "getopt" $file ) ]]; then    
<<<<<<< HEAD
        if [[ $( grep -q "#!/bin/sh" $file ) -eq 1 ]]; then 
=======
<<<<<<< HEAD
        echo $file
        if [[ $( grep -q "#!/bin/sh" $file ) -eq 0 ]]; then 
>>>>>>> 54ef2d0 (rebase from master and fixed heop in record-screen)
            sed -i -e '/#!\/bin\/sh/r../data/basic-getopt-code' $file
            continue
        fi
<<<<<<< HEAD
        if [[ $( grep -q "#!/bin/bash" $file ) -eq 1 ]]; then
=======
        if [[ $( grep -q "#!/bin/bash" $file ) -eq 0 ]]; then
=======
        
        if [[ $( grep -q "#!/bin/sh" $file ) -eq 0 || $( grep -q "#!/bin/bash" $file ) -eq 0 ]]; then 
            echo $file
            sed -i -e '/#!\/bin\/sh/r../data/basic-getopt-code' $file
            continue;
>>>>>>> 2825a02 (rebase from master and fixed heop in record-screen)
>>>>>>> 54ef2d0 (rebase from master and fixed heop in record-screen)
            sed -i -e '/#!\/bin\/bash/r../data/basic-getopt-code' $file
        fi
    fi

done

unset IFS