#!/bin/sh

SHORTOPTS=":h"
LONGOPTS="help"
OPTS=$(getopt -o $SHORTOPTS --longoptions $LONGOPTS -n "$0" -- "$@")
eval set -- "$OPTS"

while [ $# -gt 0 ]; do
    case $1 in
        -h|--help)
            echo "Usage: "
            echo "Description"
            echo 
            #list of options following
            echo -e "-h \t print this message"
        	exit 0
        ;;
        --)
           shift
           break
        ;;

    esac
    shift
done

. /home/functions 

H_FILE="headers.conf"

find . -name "*.h" > $H_FILE

while read line 
do 
	msg_info "Reading $line..."
	if grep "Q_OBJECT" $line 
	then 
		msg_info "Q_OBJECT macro found."
		OUTPUT_MOC=$(echo $line | sed "s/\.h/.cpp/g" | sed "s|/|_|g" | sed "s/^/moc_/g")
		msg_info "Output file: $OUTPUT_MOC"
		moc $line -o $OUTPUT_MOC
	fi
done < $H_FILE
